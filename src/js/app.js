var tankerapp=angular.module("tankerapp",["ui.router","ngMaterial","ui.bootstrap","ui.bootstrap.datetimepicker","ui.grid","ui.grid.selection","ui.grid.resizeColumns","ui.grid.pagination","ui.grid.edit","ui-notification","ngFileUpload"]);angular.module("tankerapp").config(["$mdDateLocaleProvider",function(e){e.formatDate=function(e){return moment(e).format("DD-MM-YYYY")}}]);var tankerapp=angular.module("tankerapp");tankerapp.config(["$stateProvider","$urlRouterProvider",function(e,a){a.otherwise("/dashboard/dailypickup"),e.state("login",{url:"/login",templateUrl:"partials/login.html",controller:"LoginCtrl"}).state("dashboard",{url:"/dashboard",controller:"appCtrl",views:{"":{templateUrl:"partials/dashboard.html"},"nav@dashboard":{templateUrl:"partials/nav.html"}}}).state("dashboard.viewdata",{url:"/viewdata",views:{contentview:{templateUrl:"partials/view-data.html"}}}).state("dashboard.dpu",{url:"/dailypickup",views:{contentview:{templateUrl:"partials/dpu.html",controller:"dpuCtrl"}}}).state("dashboard.cip",{url:"/cip",views:{contentview:{templateUrl:"partials/cip.html",controller:"cipCtrl"}}}).state("dashboard.tloc",{url:"/tankerlocation",views:{contentview:{templateUrl:"partials/tloc.html",controller:"tlocCtrl"}}}).state("dashboard.route",{url:"/route",views:{contentview:{templateUrl:"partials/route.html",controller:"routeCtrl"}}}).state("dashboard.route.start",{url:"/start",views:{routeview:{templateUrl:"partials/routestart.html",controller:"routestartCtrl"}}}).state("dashboard.route.end",{url:"/end",views:{routeview:{templateUrl:"partials/routeend.html",controller:"routeendCtrl"}}}).state("dashboard.route.data",{url:"/data",views:{routeview:{templateUrl:"partials/routedata.html",controller:"routedataCtrl"}}}).state("dashboard.supplier",{url:"/supplier",views:{contentview:{templateUrl:"partials/supplier.html",controller:"supplierCtrl"}}}).state("dashboard.labr",{url:"/labresults",views:{contentview:{templateUrl:"partials/labr.html",controller:"labrCtrl"}}}).state("dashboard.device",{url:"/device",views:{contentview:{templateUrl:"partials/device.html",controller:"deviceCtrl"}}}).state("dashboard.driver",{url:"/driver",views:{contentview:{templateUrl:"partials/driver.html",controller:"driverCtrl"}}})}]);var tankerapp=angular.module("tankerapp");tankerapp.run(["$rootScope","$state","$http","$interval","dfo","Notification",function(e,a,t,d,i,o){e.device||(e.device=i.getMethod("device/fetchall").then(function(e){return e})),e.$on("$stateChangeStart",function(e,t,d,i,r){if("login"!==t.name&&"forgot"!==t.name){var n=sessionStorage.getItem("time");if(n||null!=n){var l=moment().toJSON(),s=moment(l).diff(moment(n)),c=moment.duration(s);console.log(c._data.minutes),parseFloat(c._data.minutes)>30&&(o.error({title:"Session Exprired",message:"Please Login Again",delay:4e3}),sessionStorage.removeItem("time"),e.preventDefault(),a.go("login"))}else e.preventDefault(),a.go("login")}})}]);var tankerapp=angular.module("tankerapp");tankerapp.controller("LoginCtrl",["$scope","$rootScope","Notification","$state",function(e,a,t,d){e.credentials={username:"",password:""},e.login=function(e){"admin"!=e.username||"admin"!=e.password?t.error({title:"Login Failed",message:"Incorrect Credentials",delay:4e3}):(sessionStorage.setItem("time",moment().toJSON()),d.go("dashboard.dpu"))}}]);var tankerapp=angular.module("tankerapp");tankerapp.controller("appCtrl",["$scope","$http","dfo","$mdSidenav","$rootScope",function(e,a,t,d,i){t.getMethod("dpu/fetch").then(function(a){e.data=a}),e.postData=function(){t.postMethod("tloc/push",e.pushtext)}}]);var tankerapp=angular.module("tankerapp");tankerapp.controller("cipCtrl",["$scope","$timeout","dfo","uiGridConstants","Notification","$rootScope",function(e,a,t,d,i,o){o.alldevices||o.device.then(function(e){o.alldevices=e}),t.getMethod("cip/fetchall").then(function(a){var t=a;e.myData=[],t.forEach(function(a,t){a.tankid="Not found",a.truckid="Not Found",angular.forEach(o.alldevices,function(e,t){e.did==a.did&&(a.tankid=e.tankid,a.truckid=e.truckid)}),e.myData.push({id:a._id.$id,tankid:a.tankid,truckid:a.truckid,did:a.did,dt:a.dt,temp:parseFloat(a.temp)/10})})}),e.formdata={},e.formdata.time=new Date,e.ok=function(){var a="##"+e.formdata.did+","+moment(e.formdata.time).format("YYYYMMDDTHHmmss")+"Z,"+10*e.formdata.temp+",";a+="return,*",t.postMethod("cip/push",a).then(function(a){200==a.status&&(e.formdata.tankid="Not found",e.formdata.truckid="Not Found",angular.forEach(o.alldevices,function(a,t){a.did==e.formdata.did&&(e.formdata.tankid=a.tankid,e.formdata.truckid=a.truckid)}),e.myData.push({id:a.data.$id,tankid:e.formdata.tankid,truckid:e.formdata.truckid,did:e.formdata.did,dt:moment(e.formdata.time).format("YYYY-MM-DD HH:mm:ss"),temp:parseFloat(e.formdata.temp)}),i.success({message:"Record Added",delay:3e3}),e.formdata={},e.formdata.time=new Date)})},e.gridOptions={data:"myData",enableGridMenu:!0,enableRowSelection:!0,selectionRowHeaderWidth:35,rowHeight:35,rowWidth:20,enableColumnResizing:!0,paginationPageSizes:[10,20,30],paginationPageSize:10,columnDefs:[{field:"did",displayName:"Device",enableCellEdit:!1},{field:"tankid",displayName:"Tank ID",enableCellEdit:!1},{field:"truckid",displayName:"Truck ID",enableCellEdit:!1},{field:"dt",displayName:"Date",enableCellEdit:!1,width:160,sort:{direction:d.DESC,priority:0}},{field:"temp",displayName:"Temp."}]},e.gridOptions.onRegisterApi=function(a){e.gridApi=a,a.edit.on.afterCellEdit(e,function(e,a,d,o){if(d!=o){var r={};r.id=e.id,r.change=a.field,-1!=["temp"].indexOf(r.change)?r.value=10*parseFloat(d):r.value=d,t.postMethod("cip/update",r).then(function(e){1==e.data?i.success({message:"Update Succcessful",delay:3e3}):i.error({message:"Updated Failed. Please try again",delay:3e3})})}})},e["delete"]=function(){if(0==e.gridApi.selection.getSelectedRows().length)i.error({message:"Please select a record ",delay:3e3});else{var a=e.gridApi.selection.getSelectedRows(),d={};d.id=a[0].id,t.postMethod("cip/delete",d).then(function(a){1==a.data?(i.success({message:"Record Deleted",delay:3e3}),angular.forEach(e.gridApi.selection.getSelectedRows(),function(a,t){e.myData.splice(e.myData.lastIndexOf(a),1)})):i.error({message:"Delete Failed. Please try again",delay:3e3})})}}}]);var tankerapp=angular.module("tankerapp");tankerapp.controller("deviceCtrl",["$scope","$timeout","dfo","uiGridConstants","Notification",function(e,a,t,d,i){t.getMethod("device/fetchall").then(function(a){var t=a;e.myData=[],t.forEach(function(a,t){e.myData.push({id:a._id.$id,did:a.did,tankid:a.tankid,truckid:a.truckid,dstatus:a.dstatus})})}),e.formdata={},e.formdata.time=new Date,e.onTimeSet=function(a,t){e.dropdownToggle=!1},e.ok=function(){var a="##"+e.formdata.did+","+e.formdata.tankid+","+e.formdata.truckid+","+e.formdata.dstatus+",";a+="return,*",t.postMethod("device/push",a).then(function(a){200==a.status&&(e.myData.push({id:a.data.$id,did:e.formdata.did,tankid:e.formdata.tankid,truckid:e.formdata.truckid,dstatus:e.formdata.dstatus}),i.success({message:"Record Added",delay:3e3}),e.formdata={},e.formdata.time=new Date)})},e.gridOptions={data:"myData",enableGridMenu:!0,enableRowSelection:!0,selectionRowHeaderWidth:35,rowHeight:35,rowWidth:20,enableColumnResizing:!0,paginationPageSizes:[10,20,30],paginationPageSize:10,columnDefs:[{field:"did",displayName:"Device",enableCellEdit:!1},{field:"tankid",displayName:"Tanker ID"},{field:"truckid",displayName:"Truck ID"},{field:"dstatus",displayName:"Status"}]},e.gridOptions.onRegisterApi=function(a){e.gridApi=a,a.edit.on.afterCellEdit(e,function(e,a,d,o){if(d!=o){var r={};r.id=e.id,r.change=a.field,-1!=["tavg","tmin","tmax","vol"].indexOf(r.change)?r.value=10*parseFloat(d):r.value=d,t.postMethod("device/update",r).then(function(e){1==e.data?i.success({message:"Update Succcessful",delay:3e3}):i.error({message:"Updated Failed. Please try again",delay:3e3})})}})},e["delete"]=function(){if(0==e.gridApi.selection.getSelectedRows().length)i.error({message:"Please select a record ",delay:3e3});else{var a=e.gridApi.selection.getSelectedRows(),d={};d.id=a[0].id,t.postMethod("device/delete",d).then(function(a){1==a.data?(i.success({message:"Record Deleted",delay:3e3}),angular.forEach(e.gridApi.selection.getSelectedRows(),function(a,t){e.myData.splice(e.myData.lastIndexOf(a),1)})):i.error({message:"Delete Failed. Please try again",delay:3e3})})}}}]);var tankerapp=angular.module("tankerapp");tankerapp.controller("dpuCtrl",["$scope","$timeout","dfo","uiGridConstants","Notification","$rootScope",function(e,a,t,d,i,o){o.alldevices||o.device.then(function(e){o.alldevices=e}),t.getMethod("dpu/fetchdpu").then(function(a){var t=a;e.myData=[],t.forEach(function(a,t){a.tankid="Not found",a.truckid="Not Found",angular.forEach(o.alldevices,function(e,t){e.did==a.did&&(a.tankid=e.tankid,a.truckid=e.truckid)}),e.myData.push({id:a._id.$id,tankid:a.tankid,truckid:a.truckid,did:a.did,dt:a.dt,lat:a.lat,"long":a["long"],route:a.route,supplier:a.supplier,vol:parseFloat(a.vol)/10,tmax:parseFloat(a.tmax)/10,tavg:parseFloat(a.tavg)/10,tmin:parseFloat(a.tmin)/10})})}),e.formdata={},e.formdata.time=new Date,e.onTimeSet=function(a,t){e.dropdownToggle=!1},e.ok=function(){var a="##"+e.formdata.did+","+moment(e.formdata.time).format("YYYYMMDDTHHmmss")+"Z,"+e.formdata.lat+","+e.formdata["long"]+","+e.formdata.supplier+","+e.formdata.route+","+parseFloat(10*e.formdata.tavg)+","+10*e.formdata.tmin+","+10*e.formdata.tmax+","+10*e.formdata.vol+",";a+="return,*",t.postMethod("dpu/push",a).then(function(a){200==a.status&&(e.formdata.tankid="Not found",e.formdata.truckid="Not Found",angular.forEach(o.alldevices,function(a,t){a.did==e.formdata.did&&(e.formdata.tankid=a.tankid,e.formdata.truckid=a.truckid)}),e.myData.push({id:a.data.$id,did:e.formdata.did,tankid:e.formdata.tankid,truckid:e.formdata.truckid,dt:moment(e.formdata.time).format("YYYY-MM-DD HH:mm:ss"),lat:e.formdata.lat,"long":e.formdata["long"],route:e.formdata.route,supplier:e.formdata.supplier,vol:parseFloat(e.formdata.vol),tmax:parseFloat(e.formdata.tmax),tavg:parseFloat(e.formdata.tavg),tmin:parseFloat(e.formdata.tmin)}),i.success({message:"Record Added",delay:3e3}),e.formdata={},e.formdata.time=new Date)})},e.gridOptions={data:"myData",enableGridMenu:!0,enableRowSelection:!0,selectionRowHeaderWidth:35,rowHeight:35,rowWidth:20,multiSelect:!1,enableColumnResizing:!0,paginationPageSizes:[10,20,30],paginationPageSize:10,columnDefs:[{field:"did",displayName:"Device",enableCellEdit:!1},{field:"tankid",displayName:"Tank ID",enableCellEdit:!1},{field:"truckid",displayName:"Truck ID",enableCellEdit:!1},{field:"dt",displayName:"Date",enableCellEdit:!1,width:160,sort:{direction:d.DESC,priority:0}},{field:"lat",displayName:"Lat"},{field:"long",displayName:"Long"},{field:"route",displayName:"Route"},{field:"supplier",displayName:"Supplier"},{field:"tavg",displayName:"Temp Avg"},{field:"tmin",displayName:"Temp Min"},{field:"tmax",displayName:"Temp Max"},{field:"vol",displayName:"Volume"}]},e.gridOptions.onRegisterApi=function(a){e.gridApi=a,a.edit.on.afterCellEdit(e,function(e,a,d,o){if(d!=o){var r={};r.id=e.id,r.change=a.field,-1!=["tavg","tmin","tmax","vol"].indexOf(r.change)?r.value=10*parseFloat(d):r.value=d,t.postMethod("dpu/update",r).then(function(e){1==e.data?i.success({message:"Update Succcessful",delay:3e3}):i.error({message:"Updated Failed. Please try again",delay:3e3})})}})},e["delete"]=function(){if(0==e.gridApi.selection.getSelectedRows().length)i.error({message:"Please select a record ",delay:3e3});else{var a=e.gridApi.selection.getSelectedRows(),d={};d.id=a[0].id,t.postMethod("dpu/delete",d).then(function(a){1==a.data?(i.success({message:"Record Deleted",delay:3e3}),angular.forEach(e.gridApi.selection.getSelectedRows(),function(a,t){e.myData.splice(e.myData.lastIndexOf(a),1)})):i.error({message:"Delete Failed. Please try again",delay:3e3})})}}}]);var tankerapp=angular.module("tankerapp");tankerapp.controller("driverCtrl",["$scope","$timeout","dfo","uiGridConstants","Notification","$rootScope",function(e,a,t,d,i,o){o.alldevices||o.device.then(function(e){o.alldevices=e}),t.getMethod("driver/fetchall").then(function(a){var t=a;e.myData=[],t.forEach(function(a,t){a.tankid="Not found",a.truckid="Not Found",angular.forEach(o.alldevices,function(e,t){e.did==a.did&&(a.tankid=e.tankid,a.truckid=e.truckid)}),e.myData.push({id:a._id.$id,tankid:a.tankid,truckid:a.truckid,did:a.did,driverid:a.driverid,drivername:a.drivername})})}),e.formdata={},e.formdata.time=new Date,e.onTimeSet=function(a,t){e.dropdownToggle=!1},e.ok=function(){var a="##"+e.formdata.did+","+e.formdata.driverid+","+e.formdata.drivername+",";a+="return,*",t.postMethod("driver/push",a).then(function(a){200==a.status&&(e.formdata.tankid="Not found",e.formdata.truckid="Not Found",angular.forEach(o.alldevices,function(a,t){a.did==e.formdata.did&&(e.formdata.tankid=a.tankid,e.formdata.truckid=a.truckid)}),e.myData.push({id:a.data.$id,did:e.formdata.did,tankid:e.formdata.tankid,truckid:e.formdata.truckid,driverid:e.formdata.driverid,drivername:e.formdata.drivername}),i.success({message:"Record Added",delay:3e3}),e.formdata={},e.formdata.time=new Date)})},e.gridOptions={data:"myData",enableGridMenu:!0,enableRowSelection:!0,selectionRowHeaderWidth:35,rowHeight:35,rowWidth:20,enableColumnResizing:!0,paginationPageSizes:[10,20,30],paginationPageSize:10,columnDefs:[{field:"did",displayName:"Device",enableCellEdit:!1},{field:"tankid",displayName:"Tank ID",enableCellEdit:!1},{field:"truckid",displayName:"Truck ID",enableCellEdit:!1},{field:"driverid",displayName:"Driver ID"},{field:"drivername",displayName:"Driver Name"}]},e.gridOptions.onRegisterApi=function(a){e.gridApi=a,a.edit.on.afterCellEdit(e,function(e,a,d,o){if(d!=o){var r={};r.id=e.id,r.change=a.field,-1!=["tavg","tmin","tmax","vol"].indexOf(r.change)?r.value=10*parseFloat(d):r.value=d,t.postMethod("driver/update",r).then(function(e){1==e.data?i.success({message:"Update Succcessful",delay:3e3}):i.error({message:"Updated Failed. Please try again",delay:3e3})})}})},e["delete"]=function(){if(0==e.gridApi.selection.getSelectedRows().length)i.error({message:"Please select a record ",delay:3e3});else{var a=e.gridApi.selection.getSelectedRows(),d={};d.id=a[0].id,t.postMethod("driver/delete",d).then(function(a){1==a.data?(i.success({message:"Record Deleted",delay:3e3}),angular.forEach(e.gridApi.selection.getSelectedRows(),function(a,t){e.myData.splice(e.myData.lastIndexOf(a),1)})):i.error({message:"Delete Failed. Please try again",delay:3e3})})}}}]);var tankerapp=angular.module("tankerapp");tankerapp.controller("labrCtrl",["$scope","$timeout","dfo","uiGridConstants","Notification","Upload",function(e,a,t,d,i,o){e.path="http://52.62.42.42/api/",t.getMethod("labr/fetchall").then(function(a){data=a,e.downloads=[],data.forEach(function(a,t){e.downloads.push(a)}),console.log(e.downloads)}),e.onFileSelect=function(a){a&&o.upload({url:"http://52.62.42.42/api/labr/upload",data:{file:a,username:e.username}}).then(function(a){console.log(a),e.downloads.push(a.data)})}}]);var tankerapp=angular.module("tankerapp");tankerapp.controller("navCtrl",["$scope","$http","$location",function(e,a,t){}]);var tankerapp=angular.module("tankerapp");tankerapp.controller("routeCtrl",["$scope","$state",function(e,a){a.go("dashboard.route.start")}]);var tankerapp=angular.module("tankerapp");tankerapp.controller("routedataCtrl",["$scope","$timeout","dfo","uiGridConstants","Notification","$rootScope",function(e,a,t,d,i,o){o.alldevices||o.device.then(function(e){o.alldevices=e}),t.getMethod("route/fetchalldata").then(function(a){var t=a;e.myData=[],t.forEach(function(a,t){a.tankid="Not found",a.truckid="Not Found",angular.forEach(o.alldevices,function(e,t){e.did==a.did&&(a.tankid=e.tankid,a.truckid=e.truckid)}),e.myData.push({id:a._id.$id,tankid:a.tankid,truckid:a.truckid,did:a.did,dt:moment(a.dt).format("DD-MM-YYYY"),routeid:a.routeid,supplier:a.supplier,suppliercrn:a.suppliercrn})})}),e.formdata={},e.formdata.time=new Date,e.onTimeSet=function(a,t){e.dropdownToggle=!1},e.ok=function(){var a="##"+e.formdata.did+","+moment(e.formdata.time).format("YYYYMMDDTHHmmss")+"Z,"+e.formdata.routeid+","+e.formdata.supplier+","+e.formdata.suppliercrn+",";a+="return,*",t.postMethod("route/pushdata",a).then(function(a){200==a.status&&(e.formdata.tankid="Not found",e.formdata.truckid="Not Found",angular.forEach(o.alldevices,function(a,t){a.did==e.formdata.did&&(e.formdata.tankid=a.tankid,e.formdata.truckid=a.truckid)}),e.myData.push({id:a.data.$id,did:e.formdata.did,tankid:e.formdata.tankid,truckid:e.formdata.truckid,dt:moment(e.formdata.time).format("DD-MM-YYYY"),routeid:e.formdata.routeid,supplier:e.formdata.supplier,suppliercrn:e.formdata.suppliercrn}),i.success({message:"Record Added",delay:3e3}),e.formdata={},e.formdata.time=new Date)})},e.gridOptions={data:"myData",enableGridMenu:!0,enableRowSelection:!0,selectionRowHeaderWidth:35,rowHeight:35,rowWidth:20,multiSelect:!1,enableColumnResizing:!0,paginationPageSizes:[10,20,30],paginationPageSize:10,columnDefs:[{field:"did",displayName:"Device",enableCellEdit:!1},{field:"tankid",displayName:"Tank ID",enableCellEdit:!1},{field:"truckid",displayName:"Truck ID",enableCellEdit:!1},{field:"dt",displayName:"Date",enableCellEdit:!1,width:120,sort:{direction:d.DESC,priority:0}},{field:"routeid",displayName:"Route ID"},{field:"supplier",displayName:"Supplier"},{field:"suppliercrn",displayName:"Supplier CRN"}]},e.gridOptions.onRegisterApi=function(a){e.gridApi=a,a.edit.on.afterCellEdit(e,function(e,a,d,o){if(d!=o){var r={};r.id=e.id,r.change=a.field,-1!=["tavg","tmin","tmax","vol"].indexOf(r.change)?r.value=10*parseFloat(d):r.value=d,t.postMethod("route/updatedata",r).then(function(e){1==e.data?i.success({message:"Update Succcessful",delay:3e3}):i.error({message:"Updated Failed. Please try again",delay:3e3})})}})},e["delete"]=function(){if(0==e.gridApi.selection.getSelectedRows().length)i.error({message:"Please select a record ",delay:3e3});else{var a=e.gridApi.selection.getSelectedRows(),d={};d.id=a[0].id,t.postMethod("route/deletedata",d).then(function(a){1==a.data?(i.success({message:"Record Deleted",delay:3e3}),angular.forEach(e.gridApi.selection.getSelectedRows(),function(a,t){e.myData.splice(e.myData.lastIndexOf(a),1)})):i.error({message:"Delete Failed. Please try again",delay:3e3})})}}}]);var tankerapp=angular.module("tankerapp");tankerapp.controller("routestartCtrl",["$scope","$timeout","dfo","uiGridConstants","Notification","$rootScope",function(e,a,t,d,i,o){o.alldevices||o.device.then(function(e){o.alldevices=e}),t.getMethod("route/fetchallstart").then(function(a){var t=a;e.myData=[],t.forEach(function(a,t){a.tankid="Not found",a.truckid="Not Found",angular.forEach(o.alldevices,function(e,t){e.did==a.did&&(a.tankid=e.tankid,a.truckid=e.truckid)}),e.myData.push({id:a._id.$id,tankid:a.tankid,truckid:a.truckid,did:a.did,dt:a.dt,rno:a.rno,lat:a.lat,"long":a["long"],dvrid:a.dvrid,prno:a.prno})})}),e.formdata={},e.formdata.time=new Date,e.onTimeSet=function(a,t){e.dropdownToggle=!1},e.ok=function(){var a="##"+e.formdata.did+","+moment(e.formdata.time).format("YYYYMMDDTHHmmss")+"Z,"+e.formdata.rno+","+e.formdata.dvrid+","+e.formdata.lat+","+e.formdata["long"]+","+e.formdata.prno+",";a+="return,*",t.postMethod("route/pushstart",a).then(function(a){200==a.status&&(e.formdata.tankid="Not found",e.formdata.truckid="Not Found",angular.forEach(o.alldevices,function(a,t){a.did==e.formdata.did&&(e.formdata.tankid=a.tankid,e.formdata.truckid=a.truckid)}),e.myData.push({id:a.data.$id,did:e.formdata.did,tankid:e.formdata.tankid,truckid:e.formdata.truckid,dt:moment(e.formdata.time).format("YYYY-MM-DD HH:mm:ss"),rno:e.formdata.rno,lat:e.formdata.lat,"long":e.formdata["long"],dvrid:e.formdata.dvrid,prno:e.formdata.prno}),i.success({message:"Record Added",delay:3e3}),e.formdata={},e.formdata.time=new Date)})},e.gridOptions={data:"myData",enableGridMenu:!0,enableRowSelection:!0,selectionRowHeaderWidth:35,rowHeight:35,rowWidth:20,enableColumnResizing:!0,paginationPageSizes:[10,20,30],paginationPageSize:10,columnDefs:[{field:"did",displayName:"Device",enableCellEdit:!1},{field:"tankid",displayName:"Tank ID",enableCellEdit:!1},{field:"truckid",displayName:"Truck ID",enableCellEdit:!1},{field:"dt",displayName:"Date",enableCellEdit:!1,width:160,sort:{direction:d.DESC,priority:0}},{field:"rno",displayName:"Route #"},{field:"dvrid",displayName:"Driver ID"},{field:"lat",displayName:"Lat"},{field:"long",displayName:"Long"},{field:"prno",displayName:"Processor #"}]},e.gridOptions.onRegisterApi=function(a){e.gridApi=a,a.edit.on.afterCellEdit(e,function(e,a,d,o){if(d!=o){var r={};r.id=e.id,r.change=a.field,-1!=["tavg","tmin","tmax","vol"].indexOf(r.change)?r.value=10*parseFloat(d):r.value=d,t.postMethod("route/updatestart",r).then(function(e){1==e.data?i.success({message:"Update Succcessful",delay:3e3}):i.error({message:"Updated Failed. Please try again",delay:3e3})})}})},e["delete"]=function(){if(0==e.gridApi.selection.getSelectedRows().length)i.error({message:"Please select a record ",delay:3e3});else{var a=e.gridApi.selection.getSelectedRows(),d={};d.id=a[0].id,t.postMethod("route/deletestart",d).then(function(a){1==a.data?(i.success({message:"Record Deleted",delay:3e3}),angular.forEach(e.gridApi.selection.getSelectedRows(),function(a,t){e.myData.splice(e.myData.lastIndexOf(a),1)})):i.error({message:"Delete Failed. Please try again",delay:3e3})})}}}]);var tankerapp=angular.module("tankerapp");tankerapp.controller("routeendCtrl",["$scope","$timeout","dfo","uiGridConstants","Notification","$rootScope",function(e,a,t,d,i,o){o.alldevices||o.device.then(function(e){o.alldevices=e}),t.getMethod("route/fetchallend").then(function(a){var t=a;e.myData=[],t.forEach(function(a,t){a.tankid="Not found",a.truckid="Not Found",angular.forEach(o.alldevices,function(e,t){e.did==a.did&&(a.tankid=e.tankid,a.truckid=e.truckid)}),e.myData.push({id:a._id.$id,tankid:a.tankid,truckid:a.truckid,did:a.did,dt:a.dt,rno:a.rno,lat:a.lat,"long":a["long"],sibtemp:parseFloat(a.sibtemp)/10,mltemp:parseFloat(a.mltemp)/10,frno:a.frno})})}),e.formdata={},e.formdata.time=new Date,e.onTimeSet=function(a,t){e.dropdownToggle=!1},e.ok=function(){var a="##"+e.formdata.did+","+moment(e.formdata.time).format("YYYYMMDDTHHmmss")+"Z,"+e.formdata.rno+","+e.formdata.lat+","+e.formdata["long"]+","+10*e.formdata.sibtemp+","+10*e.formdata.mltemp+","+e.formdata.frno+",";a+="return,*",t.postMethod("route/pushend",a).then(function(a){200==a.status&&(e.formdata.tankid="Not found",e.formdata.truckid="Not Found",angular.forEach(o.alldevices,function(a,t){a.did==e.formdata.did&&(e.formdata.tankid=a.tankid,e.formdata.truckid=a.truckid)}),e.myData.push({id:a.data.$id,did:e.formdata.did,tankid:e.formdata.tankid,truckid:e.formdata.truckid,dt:moment(e.formdata.time).format("YYYY-MM-DD HH:mm:ss"),rno:e.formdata.rno,lat:e.formdata.lat,"long":e.formdata["long"],sibtemp:parseFloat(e.formdata.sibtemp),mltemp:parseFloat(e.formdata.mltemp),frno:e.formdata.frno}),i.success({message:"Record Added",delay:3e3}),e.formdata={},e.formdata.time=new Date)})},e.gridOptions={data:"myData",enableGridMenu:!0,enableRowSelection:!0,selectionRowHeaderWidth:35,rowHeight:35,rowWidth:20,enableColumnResizing:!0,paginationPageSizes:[10,20,30],paginationPageSize:10,columnDefs:[{field:"did",displayName:"Device",enableCellEdit:!1},{field:"tankid",displayName:"Tank ID",enableCellEdit:!1},{field:"truckid",displayName:"Truck ID",enableCellEdit:!1},{field:"dt",displayName:"Date",enableCellEdit:!1,width:160,sort:{direction:d.DESC,priority:0}},{field:"rno",displayName:"Route #"},{field:"lat",displayName:"Lat"},{field:"long",displayName:"Long"},{field:"sibtemp",displayName:"S. Ice Box Temp."},{field:"mltemp",displayName:"Milk Load Temp."},{field:"frno",displayName:"Factory #"}]},e.gridOptions.onRegisterApi=function(a){e.gridApi=a,a.edit.on.afterCellEdit(e,function(e,a,d,o){if(d!=o){var r={};r.id=e.id,r.change=a.field,-1!=["sibtemp","mltemp"].indexOf(r.change)?r.value=10*parseFloat(d):r.value=d,t.postMethod("route/updateend",r).then(function(e){1==e.data?i.success({message:"Update Succcessful",delay:3e3}):i.error({message:"Updated Failed. Please try again",delay:3e3})})}})},e["delete"]=function(){if(0==e.gridApi.selection.getSelectedRows().length)i.error({message:"Please select a record ",delay:3e3});else{var a=e.gridApi.selection.getSelectedRows(),d={};d.id=a[0].id,t.postMethod("route/deleteend",d).then(function(a){1==a.data?(i.success({message:"Record Deleted",delay:3e3}),angular.forEach(e.gridApi.selection.getSelectedRows(),function(a,t){e.myData.splice(e.myData.lastIndexOf(a),1)})):i.error({message:"Delete Failed. Please try again",delay:3e3})})}}}]);var tankerapp=angular.module("tankerapp");tankerapp.controller("supplierCtrl",["$scope","$timeout","dfo","uiGridConstants","Notification","$rootScope",function(e,a,t,d,i,o){o.alldevices||o.device.then(function(e){o.alldevices=e}),t.getMethod("supplier/fetchall").then(function(a){var t=a;e.myData=[],t.forEach(function(a,t){a.tankid="Not found",a.truckid="Not Found",angular.forEach(o.alldevices,function(e,t){e.did==a.did&&(a.tankid=e.tankid,a.truckid=e.truckid)}),e.myData.push({id:a._id.$id,tankid:a.tankid,truckid:a.truckid,did:a.did,supID:a.supID,pid:a.pid,pname:a.pname,supno:a.supno,supname:a.supname,lat:a.lat,"long":a["long"],expqty:parseFloat(a.expqty)/10})})}),e.formdata={},e.panelstatus=!1,e.ok=function(){var a="##"+e.formdata.did+","+e.formdata.supID+","+e.formdata.pid+","+e.formdata.pname+","+e.formdata.supno+","+e.formdata.supname+","+e.formdata.lat+","+e.formdata["long"]+","+10*e.formdata.expqty+",";a+="return,*",t.postMethod("supplier/push",a).then(function(a){200==a.status&&(e.formdata.tankid="Not found",e.formdata.truckid="Not Found",angular.forEach(o.alldevices,function(a,t){a.did==e.formdata.did&&(e.formdata.tankid=a.tankid,e.formdata.truckid=a.truckid)}),e.myData.push({id:a.data.$id,did:e.formdata.did,tankid:e.formdata.tankid,truckid:e.formdata.truckid,supID:e.formdata.supID,pid:e.formdata.pid,pname:e.formdata.pname,supno:e.formdata.supno,supname:e.formdata.supname,lat:e.formdata.lat,"long":e.formdata["long"],expqty:parseFloat(e.formdata.expqty)}),i.success({message:"Record Added",delay:3e3}),e.panelstatus=!1,e.formdata={})})},e.gridOptions={data:"myData",enableGridMenu:!0,enableRowSelection:!0,selectionRowHeaderWidth:35,rowHeight:35,rowWidth:20,enableColumnResizing:!0,paginationPageSizes:[10,20,30],paginationPageSize:10,columnDefs:[{field:"did",displayName:"Device",enableCellEdit:!1},{field:"tankid",displayName:"Tank ID",enableCellEdit:!1},{field:"truckid",displayName:"Truck ID",enableCellEdit:!1},{field:"supID",displayName:"Supp ID"},{field:"pid",displayName:"Processor ID"},{field:"pname",displayName:"Processor Name"},{field:"supno",displayName:"Supp #"},{field:"supname",displayName:"Supp Name"},{field:"lat",displayName:"Lat"},{field:"long",displayName:"Long"},{field:"expqty",displayName:"QTY"}]},e.gridOptions.onRegisterApi=function(a){e.gridApi=a,a.edit.on.afterCellEdit(e,function(e,a,d,o){if(d!=o){var r={};r.id=e.id,r.change=a.field,-1!=["expqty"].indexOf(r.change)?r.value=10*parseFloat(d):r.value=d,t.postMethod("supplier/update",r).then(function(e){1==e.data?i.success({message:"Update Succcessful",delay:3e3}):i.error({message:"Updated Failed. Please try again",delay:3e3})})}})},e["delete"]=function(){if(0==e.gridApi.selection.getSelectedRows().length)i.error({message:"Please select a record ",delay:3e3});else{var a=e.gridApi.selection.getSelectedRows(),d={};d.id=a[0].id,t.postMethod("supplier/delete",d).then(function(a){1==a.data?(i.success({message:"Record Deleted",delay:3e3}),angular.forEach(e.gridApi.selection.getSelectedRows(),function(a,t){e.myData.splice(e.myData.lastIndexOf(a),1)})):i.error({message:"Delete Failed. Please try again",delay:3e3})})}}}]);var tankerapp=angular.module("tankerapp");tankerapp.controller("tlocCtrl",["$scope","$timeout","dfo","uiGridConstants","Notification","$rootScope",function(e,a,t,d,i,o){o.alldevices||o.device.then(function(e){o.alldevices=e}),t.getMethod("tloc/fetchall").then(function(a){var t=a;e.myData=[],t.forEach(function(a,t){a.tankid="Not found",a.truckid="Not Found",angular.forEach(o.alldevices,function(e,t){e.did==a.did&&(a.tankid=e.tankid,a.truckid=e.truckid)}),e.myData.push({id:a._id.$id,tankid:a.tankid,truckid:a.truckid,did:a.did,dt:a.dt,lat:a.lat,"long":a["long"]})})}),e.dropdownToggle=!1,e.formdata={},e.formdata.time=new Date,e.onTimeSet=function(a,t){e.dropdownToggle=!1},e.ok=function(){var a="##"+e.formdata.did+","+moment(e.formdata.time).format("YYYYMMDDTHHmmss")+"Z,"+e.formdata.lat+","+e.formdata["long"]+",";a+="return,*",t.postMethod("tloc/push",a).then(function(a){200==a.status&&(e.formdata.tankid="Not found",e.formdata.truckid="Not Found",angular.forEach(o.alldevices,function(a,t){a.did==e.formdata.did&&(e.formdata.tankid=a.tankid,e.formdata.truckid=a.truckid)}),e.myData.push({id:a.data.$id,did:e.formdata.did,tankid:e.formdata.tankid,truckid:e.formdata.truckid,dt:moment(e.formdata.time).format("YYYY-MM-DD HH:mm:ss"),lat:e.formdata.lat,"long":e.formdata["long"]}),i.success({message:"Record Added",delay:3e3}),e.formdata={},e.formdata.time=new Date)})},e.gridOptions={data:"myData",enableGridMenu:!0,enableRowSelection:!0,selectionRowHeaderWidth:35,rowHeight:35,rowWidth:20,enableColumnResizing:!0,paginationPageSizes:[10,20,30],paginationPageSize:10,columnDefs:[{field:"did",displayName:"Device",enableCellEdit:!1},{field:"tankid",displayName:"Tank ID",enableCellEdit:!1},{field:"truckid",displayName:"Truck ID",enableCellEdit:!1},{field:"dt",displayName:"Date",enableCellEdit:!1,width:160,sort:{direction:d.DESC,priority:0}},{field:"lat",displayName:"Lat"},{field:"long",displayName:"Long"}]},e.gridOptions.onRegisterApi=function(a){e.gridApi=a,a.edit.on.afterCellEdit(e,function(e,a,d,o){if(d!=o){var r={};r.id=e.id,r.change=a.field,r.value=d,t.postMethod("tloc/update",r).then(function(e){1==e.data?i.success({message:"Update Succcessful",delay:3e3}):i.error({message:"Updated Failed. Please try again",delay:3e3})})}})},e["delete"]=function(){if(0==e.gridApi.selection.getSelectedRows().length)i.error({message:"Please select a record ",delay:3e3});else{var a=e.gridApi.selection.getSelectedRows(),d={};d.id=a[0].id,t.postMethod("tloc/delete",d).then(function(a){1==a.data?(i.success({message:"Record Deleted",delay:3e3}),angular.forEach(e.gridApi.selection.getSelectedRows(),function(a,t){e.myData.splice(e.myData.lastIndexOf(a),1)})):i.error({message:"Delete Failed. Please try again",delay:3e3})})}}}]);var tankerapp=angular.module("tankerapp");tankerapp.factory("dfo",["$http","$q",function(e,a){return{getMethod:function(t){var d=a.defer();return e({url:"http://localhost/tankerApi/"+t,method:"GET"}).then(function(e){d.resolve(e.data)},function(e){d.reject(e)}),d.promise},postMethod:function(t,d){var i=a.defer();return e({url:"http://localhost/tankerApi/"+t,headers:{"Content-Type":"text/html"},method:"POST",data:{query:d}}).then(function(e){i.resolve(e)},function(e){i.reject("Failed")}),i.promise}}}]);